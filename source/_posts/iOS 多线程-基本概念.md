---
title: iOS 多线程-基本概念 
date: 2017-03-10 21:10:07
tags:
- iOS
- 多线程

categories: 
- iOS
- 多线程
---

# 进程与线程
## 进程
Q：什么是进程？
A：进程是指在系统中`正在运行`的一个应用程序。
eg：比如同时打开微信、QQ，系统就会分别启动两个进程。
> 注意：每个进程之间是`独立`的且均运行在其专用并受保护的内存空间内。

![](https://blogimages-1254431338.cos.ap-shenzhen-fsi.myqcloud.com/Snip20170316_4.png?imageView2/0/h/120/)

## 线程
Q：什么是线程？
A：`线程`是`进程`的`基本执行单元`，一个进程想要执行任务，必须得有线程（每个进程至少要有一个线程）。
eg：比如使用 QQ 进行文字聊天，使用微信进行视频聊天，都需要在各自的线程中执行。

![](https://blogimages-1254431338.cos.ap-shenzhen-fsi.myqcloud.com/Snip20170316_3.png?imageView2/0/h/120/)
<!-- more -->
## 线程的串行
Q：什么是线程的串行？
A：如果要在一个线程中执行多个任务，那么只能一个一个的按照顺利执行这些任务，也就是说：`在同一时间内，一个线程中只能执行一个任务`。
eg：比如在一个线程中有 3 个下载任务（任务 A，任务 B，任务 C）

![](https://blogimages-1254431338.cos.ap-shenzhen-fsi.myqcloud.com/Snip20170316_7.png?imageView2/0/h/250/)

## 多线程
Q：什么是多线程？
A：一个进程中可以开启多条线程，每条线程可以`并行（同时）`执行不同的任务。
eg：可以将进程比作工厂车间，线程比作车间工人，由不任务的车间工人在车间运作，最后生产出产品。因此，可以说`多线程技术可以提高程序的执行效率`。

比如：同时开启 3 条线程分别来执行 3 个下载任务（任务 A，任务 B，任务 C）

![](https://blogimages-1254431338.cos.ap-shenzhen-fsi.myqcloud.com/Snip20170316_8.png?imageView2/0/h/170/)


## 多线程的原理

1. 同一时间，CPU 只能处理一条线程，只有一条线程在工作
2. 多线程并发执行时，其实是 CPU 快速的在线程之间调度切换
3. 如果 CPU 调度线程的时间足够快，就造成了多条线程并发执行的假象

>考虑情况：如果线程非常非常多，会发生什么情况？

A：CPU 会在多个线程之间调度，最终会导致 CPU 累死，消耗大量的 CPU 资源，并且每条线程被执行的频率降低，导致线程的执行效率降低

![](https://blogimages-1254431338.cos.ap-shenzhen-fsi.myqcloud.com/Snip20170316_9.png?imageView2/0/h/170/)

## 多线程的优缺点
### #多线程的优点
1. 能够适当的提高程序的执行效率；
2. 能够适当提高资源的利用率（CPU、内存的利用率）

### #多线程的缺点
1. 创建线程是有开销的，iOS 主要的成本包括：内核数据结构（大于 1 KB）、栈空间（子线程 512 KB、主线程 1 M，也可以使用 `setStackSize:` 设置，但必须是 4 K 的倍数，而且最小是 16 K），创建线程约需要 90 毫秒的创建时间
2. 如果开启大量的线程，会占用大量的内存空间，降低程序的性能
3. 线程越多，CPU 在调度线程上的开销就越大
4. 程序设计会更加复杂：比如线程之间的通信，多线程的数据共享等


# iOS 中的多线程
## 什么是主线程？
- 一个 iOS 程序运行后，默认会开启 1 条线程，该线程称为“`主线程`”或“`UI 线程`”。

## 主线程的主要作用？
1. 显示/刷新 UI 界面
2. 处理 UI 事件（比如点击事件、滚动事件、拖拽事件等）

## 主线程的使用注意？
- 不要将比较耗时的操作放置在主线程中，因为耗时操作会卡住主线程严重影响界面流畅度，会给用户一种“卡”的感觉，体验效果不好。

## 多线程的实现方案

![](https://blogimages-1254431338.cos.ap-shenzhen-fsi.myqcloud.com/Snip20170316_10.png?imageView2/0/h/370/)

> 备注：`pthread`: iOS 10 已经找不到了这个方法 